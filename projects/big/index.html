<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="description" content="UIC Bus Tracker">
	<meta name="keywords" content="CTA,UIC,Bus,Train,Subway,Chicago,Transit,Authority,Tracker">
	<meta name="author" content="Sagar Patel">
	<title>UICBusTracker</title>
  	<link href="https://unpkg.com/material-components-web@0.34.1/dist/material-components-web.min.css" rel="stylesheet">
  	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  	
  	<link rel="shortcut icon" type="image/x-icon" href="./imgs/favicon.ico"/>
  	
  	<link rel="manifest" href="./manifest.json">
	
	<style type="text/css">
	  	.hide {
	  		display: none;
	  	}
	  	#busTrainTabBar {
			padding-top: 30px;
			padding-bottom: 40px;
		}
		#logoImg {
			width: 100%;
		}
  		#shrine-header {
  			background-color: #E2E2E2;
  		}
  		.submitBtn {
			font-size: 30px;
		}
		#map {
	   		margin: 20px;
	   		padding: 20px;
        	height: 850px;
        }
  		.container {
			text-align: center;
			margin: auto;
			width: 66.6%;
			height: 66.6%;
		}
		#shrine-header .mdc-toolbar__section {
			overflow: visible;
		}
		.mdc-tab {
			font-size: 25px;
			padding: 15px 50px;
		}
		.mdc-select {
			margin: 30px;
			width: 30%;
		}
		.mdc-button {
			margin: 20px;
		}
		.mdc-radio {
			padding: 30px;
		}
		
	</style>
</head>

<body class="mdc-typography">
	<!-- tool bar -->
	<header id="shrine-header" class="mdc-toolbar mdc-toolbar--fixed mdc-theme--text-primary-on-background">
		<div class="mdc-toolbar__row">
	    	<section class="mdc-toolbar__section mdc-toolbar__section--align-start">
				<a id="shrine-nav-icon" class="material-icons mdc-ripple-surface"
				   href="#"
				   aria-label="Click to show the navigation menu"
				   aria-controls="shrine-nav-menu"
				   data-mdc-auto-init="MDCRipple"
				   data-mdc-ripple-is-unbounded>menu
				</a>
		    </section>
	  	</div>
	</header>
	<!-- temporary drawer of the tool bar -->
	<aside class="mdc-drawer mdc-drawer--temporary mdc-typography">
		<nav class="mdc-drawer__drawer">
	    	<header class="mdc-drawer__header">
	      		<div class="mdc-drawer__header-content">
	      			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">directions_bus</i>
	      			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">train</i>
	      			<strong>UIC Bus APP</strong>
	      		</div>	
	    	</header>
	    	<nav id="icon-with-text-demo" class="mdc-drawer__content mdc-list">
	      		<a id="arrivalsNav" class="mdc-list-item mdc-list-item--activated" href="#">
	       			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">alarm</i>Estimated Arrivals
	      		</a>
	      		<a id="aroundMeNav" class="mdc-list-item" href="#">
	       			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">person_pin_circle</i>around Me
	      		</a>
	      		<a id="distanceNav" class="mdc-list-item" href="#">
	        		<i class="material-icons mdc-list-item__graphic" aria-hidden="true">distance</i>distance
	      		</a>
	    	</nav>
	  	</nav>
	</aside>

	<!-- screen 1 -->
	<div id="arrivalsScreen">
		<br><br><br>
		<!-- UIC Halsted image -->
		<img id="logoImg" src="imgs/bus.png">
		<div class="container">
			<!-- bus/train tab bar  -->
			<div id="busTrainTabBar">
				<nav id="basic-tab-bar" class="mdc-tab-bar">
					<a id="busNav" class="mdc-tab mdc-tab--active" href="#">Bus</a>
					<a id="trainNav" class="mdc-tab" href="#">Train</a>
					<span class="mdc-tab-bar__indicator"></span>
				</nav>
			</div>
			<div id="busTab">
				<!-- bus route drop down select menu -->
				<div id="busRoute" class="mdc-select">
					<select id="busRouteSelect" class="mdc-select__native-control">
						<option id="disabledOption" value="" disabled selected></option>
						<option value="7">7 - Harrison</option>
						<option value="8">8 - Halsted</option>
						<option value="12">12 - Roosevelt</option>
						<option value="60">60 - Blue Island/26th</option>
						<option value="157">157 - Streeterville/Taylor</option>
					</select>
					<div class="mdc-select__label">Select Route</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- bus direction drop down select menu -->
				<div id="busDirection" class="mdc-select">
					<select id="busDirectionSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
					</select>
					<div class="mdc-select__label">Select Direction</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- bus stop drop down select menu -->
				<div id="busStop" class="mdc-select">
					<select id="busStopSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option  id="none" class="hide" value="none">Placeholder</option>
					</select>
					<div class="mdc-select__label">Select Stop</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br><br>
				<button id="busSubmitBtn" class="mdc-button submitBtn" disabled><strong>TRACK</strong></button>
				<div class="results">
					<ul id="busResults" class="mdc-list">
						<li class="mdc-list-item hide">Single-line item</li>
					</ul>
				</div>
			</div>
			<div id="trainTab" class="hide">
				<!-- train route drop down select menu -->
				<div id="trainStop" class="mdc-select">
					<select id="trainStopSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option value="Clarke/Lake">Clarke/Lake</option>
						<option value="Washington">Washington</option>
						<option value="Monroe">Monroe</option>
						<option value="Jackson">Jackson</option>
						<option value="LaSalle">LaSalle</option>
						<option value="Clinton">Clinton</option>
						<option value="UIC-Halsted">UIC-Halsted</option>
						<option value="Racine">Racine</option>
						<option value="Illinois Medical District">Illinois Medical District</option>
					</select>
					<div class="mdc-select__label">Select Stop</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- radio button for Forest Park -->
				<div class="mdc-radio">
					<input id="FP" class="mdc-radio__native-control" type="radio" id="radio-1" name="radios" checked>
					<div class="mdc-radio__background">
						<div class="mdc-radio__outer-circle"></div>
						<div class="mdc-radio__inner-circle"></div>
					</div>
				</div>
				<label id="radio-1-label" class="bound" for="radio-1">To Forest Park</label>
				<!-- radio button for O'Hare -->
				<div class="mdc-radio">
					<input id="OH" class="mdc-radio__native-control" type="radio" id="radio-2" name="radios">
					<div class="mdc-radio__background">
						<div class="mdc-radio__outer-circle"></div>
						<div class="mdc-radio__inner-circle"></div>
					</div>
				</div>
				<label id="radio-2-label" class="bound" for="radio-2">To O'Hare</label>
				<br><br><br>
				<button id="trainSubmitBtn" class="mdc-button submitBtn" disabled><strong>TRACK</strong></button>
				<div class="results">
					<ul id="trainResults" class="mdc-list">
						<li class="mdc-list-item hide">Single-line item</li>
					</ul>
				</div>
			</div>
		</div>â€‹
	</div>

	
	<div id="aroundMeScreen" class="hide">
		<br><br><br>
		<div id="map"></div>
	</div>


	<div id="distanceScreen" class="hide">
		<br><br><br><br>
		<div class="container">
			<!-- bus route drop down select menu -->
			<div id="distanceDiv" class="mdc-select">
				<select id="distanceSelect" class="mdc-select__native-control">
					<option id="disabledOption" value="" disabled selected></option>
					<option value="18">0.1 miles</option>
					<option value="17">0.5 miles</option>
					<option value="16">1.0 miles</option>
					<option value="15">2.0 miles</option>
				</select>
				<div class="mdc-select__label">'around Me' miles away</div>
				<div class="mdc-select__bottom-line"></div>
			</div>
			<br><br><br><br>
			<button id="saveChanges" class="mdc-button submitBtn" disabled><strong>Save Changes</strong></button>
			<div class="results">
				<ul id="saveResults" class="mdc-list">
					<li class="mdc-list-item hide">Single-line item</li>
				</ul>
			</div>
		</div>
	</div>

	
	<script src="https://unpkg.com/material-components-web@0.34.1/dist/material-components-web.js"></script>


	<script
		src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		crossorigin="anonymous">
	</script>
	
	
	<script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>

    
    <script type="text/javascript">
    	$(document).ready(function(){
	   		console.log("Document Ready");
	   	});
    	
	   	var proxy = "https://polar-garden-75406.herokuapp.com/apiPassThru.php?apiEndpoint=";
	   	
	   	let drawer = new mdc.drawer.MDCTemporaryDrawer(document.querySelector('.mdc-drawer--temporary'));
		document.querySelector('#shrine-nav-icon').addEventListener('click', () => drawer.open = true);
		
	   	var sevenSixtyEast = [
	   		{rt: "7, 60", dir: "Eastbound", stpid: "14210", stpnm: "Canal & Harrison", lat: 41.874637890315, lon: -87.639527320862},
	   		{rt: "7, 60", dir: "Eastbound", stpid: "17995", stpnm: "Harrison & Jefferson", lat: 41.874344986696, lon: -87.641897334914},
	   		{rt: "7, 60", dir: "Eastbound", stpid: "6347", stpnm: "Harrison & Halsted", lat: 41.874246439513, lon: -87.647445201874},
	   		{rt: "7, 60", dir: "Eastbound", stpid: "201", stpnm: "900 W Harrison", lat: 41.874346299639, lon: -87.648807764053},
	   		{rt: "7, 60", dir: "Eastbound", stpid: "200", stpnm: "Harrison & Morgan", lat: 41.874286383582, lon: -87.651940584183}
	   	];
	   	var sevenSixtyWest = [
	   		{rt: "7, 60", dir: "Westbound", stpid: "6364", stpnm: "Clinton & Harrison", lat: 41.874438170818, lon: -87.640986442566},
	   		{rt: "7, 60", dir: "Westbound", stpid: "6365", stpnm: "Harrison & Jefferson", lat: 41.874410210038, lon: -87.642263174057},
	   		{rt: "7, 60", dir: "Westbound", stpid: "206", stpnm: "Harrison & Halsted", lat: 41.874442165214, lon: -87.647734880447},
	   		{rt: "7, 60", dir: "Westbound", stpid: "207", stpnm: "900 W Harrison", lat: 41.87449409234, lon: -87.649258375168},
	   		{rt: "7, 60", dir: "Westbound", stpid: "208", stpnm: "Harrison & Morgan", lat: 41.874450154005, lon: -87.651591897011}
	   	];
	   	var sevenEast = [
	   		{rt: "7", dir: "Eastbound", stpid: "18336", stpnm: "Harrison & Loomis", lat: 41.874141143355, lon: -87.661574504299},
	   		{rt: "7", dir: "Eastbound", stpid: "198", stpnm: "Harrison & Racine", lat: 41.874202501008, lon: -87.656666636467},
	   		{rt: "7", dir: "Eastbound", stpid: "18339", stpnm: "Harrison & Throop", lat: 41.874168445122, lon: -87.659573933194}
		];
		var sevenWest = [
			{rt: "7", dir: "Westbound", stpid: "18335", stpnm: "Harrison & Loomis", lat: 41.874255633116, lon: -87.661988906746},
			{rt: "7", dir: "Westbound", stpid: "210", stpnm: "Harrison & Racine", lat: 41.874354288443, lon: -87.657428383827},
			{rt: "7", dir: "Westbound", stpid: "18340", stpnm: "Harrison & Throop", lat: 41.874297368196, lon: -87.659625113009}
		];
		var eightSouth = [
			{rt: "8", dir: "Southbound", stpid: "5804", stpnm: "Halsted & 14th Place", lat: 41.862389936575, lon: -87.646812200546},
			{rt: "8", dir: "Southbound", stpid: "4638", stpnm: "Halsted & Harrison", lat: 41.873831019714, lon: -87.647214531898},
			{rt: "8", dir: "Southbound", stpid: "5799", stpnm: "Halsted & Jackson", lat: 41.878029032111, lon: -87.647313236666},
			{rt: "8", dir: "Southbound", stpid: "15008", stpnm: "Halsted & Madison", lat: 41.881503067986, lon: -87.647415161918},
			{rt: "8", dir: "Southbound", stpid: "5802", stpnm: "Halsted & Maxwell", lat: 41.864866881017, lon: -87.646881937981},
			{rt: "8", dir: "Southbound", stpid: "15352", stpnm: "Halsted & Monroe", lat: 41.88025454567, lon: -87.647378468173},
			{rt: "8", dir: "Southbound", stpid: "4639", stpnm: "Halsted & Polk", lat: 41.871937629893, lon: -87.647150158882},
			{rt: "8", dir: "Southbound", stpid: "17366", stpnm: "Halsted & Roosevelt", lat: 41.867215894509, lon: -87.646951675415},
			{rt: "8", dir: "Southbound", stpid: "4640", stpnm: "Halsted & Taylor", lat: 41.869896380997, lon: -87.647096514702},
			{rt: "8", dir: "Southbound", stpid: "205", stpnm: "UIC-Halsted Blue Line Station", lat: 41.875513453518, lon: -87.647277832293}
		];
		var eightNorth = [
			{rt: "8", dir: "Northbound", stpid: "5926", stpnm: "Halsted & 14th Place", lat: 41.862198169133, lon: -87.64672100544},
			{rt: "8", dir: "Northbound", stpid: "18009", stpnm: "Halsted & Jackson", lat: 41.878208885061, lon: -87.647189001581},
			{rt: "8", dir: "Northbound", stpid: "440", stpnm: "Halsted & Madison", lat: 41.882007103365, lon: -87.647316455841},
			{rt: "8", dir: "Northbound", stpid: "5928", stpnm: "Halsted & Maxwell", lat: 41.864655145968, lon: -87.646796107292},
			{rt: "8", dir: "Northbound", stpid: "5931", stpnm: "Halsted & Monroe", lat: 41.880271320896, lon: -87.647260665108},
			{rt: "8", dir: "Northbound", stpid: "4618", stpnm: "Halsted & Polk", lat: 41.871777847595, lon: -87.646887302399},
			{rt: "8", dir: "Northbound", stpid: "14777", stpnm: "Halsted & Roosevelt", lat: 41.867631357301, lon: -87.646871209145},
			{rt: "8", dir: "Northbound", stpid: "14487", stpnm: "Halsted & Taylor", lat: 41.869756567043, lon: -87.646833658218},
			{rt: "8", dir: "Northbound", stpid: "18184", stpnm: "UIC-Halsted Blue Line Station", lat: 41.875578047547, lon: -87.647168084553}
		];
		var twelveEast = [
			{rt: "12", dir: "Eastbound", stpid: "313", stpnm: "327 W Roosevelt", lat: 41.867199915117, lon: -87.635573744774},
			{rt: "12", dir: "Eastbound", stpid: "307", stpnm: "900 W Roosevelt", lat: 41.867020146681, lon: -87.649419307709},
			{rt: "12", dir: "Eastbound", stpid: "305", stpnm: "Roosevelt & Blue Island", lat: 41.86695223403, lon: -87.653641104698},
			{rt: "12", dir: "Eastbound", stpid: "312", stpnm: "Roosevelt & Canal", lat: 41.867151976917, lon: -87.638840675354},
			{rt: "12", dir: "Eastbound", stpid: "14459", stpnm: "Roosevelt & Halsted", lat: 41.867064090124, lon: -87.646324038506},
			{rt: "12", dir: "Eastbound", stpid: "310", stpnm: "Roosevelt & Jefferson", lat: 41.867120018097, lon: -87.642295360565},
			{rt: "12", dir: "Eastbound", stpid: "17003", stpnm: "Roosevelt & May", lat: 41.866924269976, lon: -87.65537917614},
			{rt: "12", dir: "Eastbound", stpid: "306", stpnm: "Roosevelt & Morgan", lat: 41.866996177518, lon: -87.651221752167}
		];
		var twelveWest = [
			{rt: "12", dir: "Westbound", stpid: "326", stpnm: "327 W Roosevelt", lat: 41.867393265591, lon: -87.635536193848},
			{rt: "12", dir: "Westbound", stpid: "332", stpnm: "900 W Roosevelt", lat: 41.867211899662, lon: -87.649462223053},
			{rt: "12", dir: "Westbound", stpid: "334", stpnm: "Roosevelt & Blue Island", lat: 41.867151976917, lon: -87.653083205223},
			{rt: "12", dir: "Westbound", stpid: "327", stpnm: "Roosevelt & Canal", lat: 41.867339734662, lon: -87.639044523239},
			{rt: "12", dir: "Westbound", stpid: "17396", stpnm: "Roosevelt & Halsted", lat: 41.867262250879, lon: -87.647493333335},
			{rt: "12", dir: "Westbound", stpid: "18174", stpnm: "Roosevelt & Jefferson", lat: 41.867300218619, lon: -87.642539020541},
			{rt: "12", dir: "Westbound", stpid: "335", stpnm: "Roosevelt & May", lat: 41.86711202839, lon: -87.655030488968},
			{rt: "12", dir: "Westbound", stpid: "333", stpnm: "Roosevelt & Morgan", lat: 41.867183935721, lon: -87.650862336159}
		];
		var sixtyEast = [
			{rt: "60", dir: "Eastbound", stpid: "6342", stpnm: "Racine & 13th Street", lat: 41.865110575204, lon: -87.65657544136},
			{rt: "60", dir: "Eastbound", stpid: "6341", stpnm: "Racine & 14th Street", lat: 41.863680356701, lon: -87.656543254852},
			{rt: "60", dir: "Eastbound", stpid: "6346", stpnm: "Racine & Harrison", lat: 41.874074679731, lon: -87.656720280647},
			{rt: "60", dir: "Eastbound", stpid: "15993", stpnm: "Racine & Lexington", lat: 41.871689967161, lon: -87.656725645065},
			{rt: "60", dir: "Eastbound", stpid: "15404", stpnm: "Racine & Roosevelt", lat: 41.867255842972, lon: -87.656655907631},
			{rt: "60", dir: "Eastbound", stpid: "6344", stpnm: "Racine & Taylor", lat: 41.869293181468, lon: -87.656731009483}
		];
		var sixtyWest = [
			{rt: "60", dir: "Westbound", stpid: "6370", stpnm: "Racine & 13th Street", lat: 41.865350273499, lon: -87.656666636467},
			{rt: "60", dir: "Westbound", stpid: "6371", stpnm: "Racine & 14th Street", lat: 41.863560504536, lon: -87.656623721123},
			{rt: "60", dir: "Westbound", stpid: "15402", stpnm: "Racine & Cabrini", lat: 41.871206622614, lon: -87.656854391098},
			{rt: "60", dir: "Westbound", stpid: "6366", stpnm: "Racine & Harrison", lat: 41.87403473553, lon: -87.656972408295},
			{rt: "60", dir: "Westbound", stpid: "15401", stpnm: "Racine & Lexington", lat: 41.872400996298, lon: -87.656972408295},
			{rt: "60", dir: "Westbound", stpid: "15403", stpnm: "Racine & Roosevelt", lat: 41.866776459772, lon: -87.656720280647},
			{rt: "60", dir: "Westbound", stpid: "15292", stpnm: "Racine & Taylor", lat: 41.869496911747, lon: -87.65682220459}
		];
		var onefiftysevenEast = [
			{rt: "157", dir: "Eastbound", stpid: "6700", stpnm: "900 W Taylor", lat: 41.869468948806, lon: -87.648759484291},
			{rt: "157", dir: "Eastbound", stpid: "6705", stpnm: "Canal & Taylor", lat: 41.869992253245, lon: -87.63925909996},
			{rt: "157", dir: "Eastbound", stpid: "6698", stpnm: "Taylor & Aberdeen", lat: 41.869436991144, lon: -87.654402852058},
			{rt: "157", dir: "Eastbound", stpid: "6701", stpnm: "Taylor & Halsted", lat: 41.869484927631, lon: -87.647375464439},
			{rt: "157", dir: "Eastbound", stpid: "6703", stpnm: "Taylor & Jefferson", lat: 41.869688657298, lon: -87.642402648926},
			{rt: "157", dir: "Eastbound", stpid: "6694", stpnm: "Taylor & Laflin", lat: 41.869265218438, lon: -87.664278745651},
			{rt: "157", dir: "Eastbound", stpid: "6695", stpnm: "Taylor & Loomis", lat: 41.869313155054, lon: -87.661719918251},
			{rt: "157", dir: "Eastbound", stpid: "6699", stpnm: "Taylor & Morgan", lat: 41.869480932925, lon: -87.651345133781},
			{rt: "157", dir: "Eastbound", stpid: "6697", stpnm: "Taylor & Racine", lat: 41.869389054621, lon: -87.656854391098},
			{rt: "157", dir: "Eastbound", stpid: "6696", stpnm: "Taylor & Throop", lat: 41.86935709692, lon: -87.659289836884}
		];
		var onefiftysevenWest = [
			{rt: "157", dir: "Westbound", stpid: "6627", stpnm: "900 W Taylor", lat: 41.869664689136, lon: -87.648534178734},
			{rt: "157", dir: "Westbound", stpid: "6623", stpnm: "Clinton & Taylor", lat: 41.869780535171, lon: -87.640820145607},
			{rt: "157", dir: "Westbound", stpid: "6629", stpnm: "Taylor & Aberdeen", lat: 41.869504901156, lon: -87.65401661396},
			{rt: "157", dir: "Westbound", stpid: "17277", stpnm: "Taylor & Halsted", lat: 41.869696646684, lon: -87.647370100021},
			{rt: "157", dir: "Westbound", stpid: "17275", stpnm: "Taylor & Jefferson", lat: 41.869748577665, lon: -87.642627954483},
			{rt: "157", dir: "Westbound", stpid: "6633", stpnm: "Taylor & Laflin", lat: 41.869333128633, lon: -87.663999795914},
			{rt: "157", dir: "Westbound", stpid: "6632", stpnm: "Taylor & Loomis", lat: 41.869373075773, lon: -87.661403417587},
			{rt: "157", dir: "Westbound", stpid: "6628", stpnm: "Taylor & Morgan", lat: 41.869536858784, lon: -87.651361227036},
			{rt: "157", dir: "Westbound", stpid: "15811", stpnm: "Taylor & Racine", lat: 41.869448975269, lon: -87.65684902668},
			{rt: "157", dir: "Westbound", stpid: "6631", stpnm: "Taylor & Throop", lat: 41.869417017597, lon: -87.659069895744}
		];
		var busStopsArr = {};
		busStopsArr["007E"] = sevenEast;
		busStopsArr["007W"] = sevenWest;
		busStopsArr["008S"] = eightSouth;
		busStopsArr["008N"] = eightNorth;
		busStopsArr["012E"] = twelveEast;
		busStopsArr["012W"] = twelveWest;
		busStopsArr["060E"] = sixtyEast;
		busStopsArr["060W"] = sixtyWest;
		busStopsArr["157E"] = onefiftysevenEast;
		busStopsArr["157W"] = onefiftysevenWest;
		busStopsArr["SMEE"] = sevenSixtyEast;
		busStopsArr["SMEW"] = sevenSixtyWest;
		
		function findStop(stopName, direction){
			var stop;
			if (direction === "FP"){
				$.each(bluelineFP, function(i, v){
					if (v.stpnm === stopName)
						stop = v;
				});
			}
			else if (direction === "OH"){
				$.each(bluelineOH, function(i, v){
					if (v.stpnm === stopName)
						stop = v;
				});
			}
			else{
				Object.keys(busStopsArr).forEach(function(key){
					$.each(busStopsArr[key], function(i, v){
						if (v.stpnm === stopName && v.dir === direction)
							stop = v;
					});
				});
			}
			return stop;
		}
		
		
		colors = {
	   		
	   		"007E": "#FF0000",
	   		"007W": "#FF0000",
	   		
	   		"008S": "#000080",
	   		"008N": "#000080",
	   		
	   		"012E": "#808000",
	   		"012W": "#808000",
	   		
	   		"060E": "#800080",
    		"060W": "#800080",
    		
    		"157E": "#FFD700",
    		"157W": "#FFD700",
    		
    		"SMEE": "#000000",
    		"SMEW": "#000000"
    	};
	   
	   	var timeURL = "http://ctabustracker.com/bustime/api/v2/gettime&key=7hV55iRDcTmvtMmgg2y9g5JWS&format=json";
	   	var currentDateTime = "1996/10/24 10:00:00";
	   	function setTime(){
	   		$.ajax({
		        url: proxy + timeURL,
		        method: 'GET',
		     }).done(function(response) {
			    	response = JSON.parse(response);
			    	var time = response["bustime-response"]["tm"];
			    	time = insertToString(time, "/", 4);
			    	time = insertToString(time, "/", 7);
			    	currentDateTime = time;
			    }).fail(function(err) {
				   		throw err;
			       });
	   	}
	   	
	   	function millisToMinutesAndSeconds(millis) {
	   		var minutes = Math.floor(millis / 60000);
	   		var seconds = ((millis % 60000) / 1000).toFixed(0);
	   		return minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
	   	}
	 
	   	function insertToString(main_string, ins_string, pos){
	   		if (typeof(pos) == "undefined") 
	   			pos = 0;
	   		if(typeof(ins_string) == "undefined") 
	   			ins_string = '';
	   		return main_string.slice(0, pos) + ins_string + main_string.slice(pos);
	   	}
	   	
	   	
		navListener("#arrivalsNav", "#arrivalsScreen", "#aroundMeNav", "#aroundMeScreen", "#distanceNav", "#distanceScreen");
		navListener("#aroundMeNav", "#aroundMeScreen", "#arrivalsNav", "#arrivalsScreen", "#distanceNav", "#distanceScreen");
		navListener("#distanceNav", "#distanceScreen", "#arrivalsNav", "#arrivalsScreen", "#aroundMeNav", "#aroundMeScreen");
		function navListener(mainNav, mainScreen, nav2, screen2, nav3, screen3){
			$(mainNav).click(function(){
				$(mainNav).addClass("mdc-list-item--activated");
				$(nav2).removeClass("mdc-list-item--activated");
				$(nav3).removeClass("mdc-list-item--activated");
				$(mainScreen).removeClass("hide");
				$(screen2).addClass("hide");
				$(screen3).addClass("hide");
				drawer.open = false;
			});
		}
	   	// add action listeners to the 'home' and 'train' tab in the 'arrivals' screen
	   	tabListener("#busNav", "#busTab", "#trainNav", "#trainTab");
	   	tabListener("#trainNav", "#trainTab", "#busNav", "#busTab");
	   	function tabListener(mainNav, mainTab, otherNav, otherTab){
			$(mainNav).click(function(){
		   		$(mainNav).addClass("mdc-tab--active");
		   		$(otherNav).removeClass("mdc-tab--active");
		   		$(mainTab).removeClass("hide");
		   		$(otherTab).addClass("hide");
		   	});
		}
	
	   	// Script for the bus route drop down select menu
		const busRouteSelect = new mdc.select.MDCSelect(document.querySelector("#busRoute"));
		// Script for the bus direction drop down select menu
		const busDirectionSelect = new mdc.select.MDCSelect(document.querySelector("#busDirection"));
		// Script for the bus stop drop down select menu
		const busStopSelect = new mdc.select.MDCSelect(document.querySelector("#busStop"));
	   	// add action listener for a change to the first drop down menu on the arrivals screen - bus tab
	   	$("#busRoute").change(function(){
	   		document.getElementById("busSubmitBtn").disabled = true;
			var busRouteSelect = document.getElementById("busRouteSelect");
			
			var clickedValue = busRouteSelect.options[busRouteSelect.selectedIndex].value;
			var busDirectionSelect = document.getElementById("busDirectionSelect");
	
			$('#busDirectionSelect').children('option:not(:first)').remove();
			
			var option = document.createElement("option");
			var option2 = document.createElement("option");
			if (clickedValue === "8") {
				option.text = "Northbound";
				option.value = "Northbound";
				busDirectionSelect.add(option);
				option2.text = "Southbound";
				option2.value = "Southbound";
				busDirectionSelect.add(option2);
			}
			else {
				option.text = "Eastbound";
				option.value = "Eastbound";
				busDirectionSelect.add(option);
				option2.text = "Westbound";
				option2.value = "Westbound";
				busDirectionSelect.add(option2);
			}
			
			$("#busDirectionSelect").prop("selectedIndex",0);
		
			$('#busStopSelect').children('option:not(:first)').remove();
		});
	   	
		$("#busDirection").change(function(){
			document.getElementById("busSubmitBtn").disabled = true;
			var route = document.getElementById("busRouteSelect").value;
			var dir = document.getElementById("busDirectionSelect").value;
			switch (route){
				case "7":
					if (dir === "Eastbound")
						addOptions("007E");
					else
						addOptions("007W");
					break;
				case "8":
					if (dir === "Northbound")
						addOptions("008N");
					else
						addOptions("008S");
					break;
				case "12":
					if (dir === "Eastbound")
						addOptions("012E");
					else
						addOptions("012W");
					break;
				case "60":
					if (dir === "Eastbound")
						addOptions("060E");
					else
						addOptions("060W");
					break;
				case "157":
					if (dir === "Eastbound")
						addOptions("157E");
					else
						addOptions("157W");
					break;
				default:
					console.log("error in busDirection change action listener");
			}
		});
		// add action listener for a change to the third drop down menu on the arrivals screen - bus tab
		$("#busStop").change(function(){
			document.getElementById("busSubmitBtn").disabled = false;
		});
		
		function addOptions(key){
			var busStopSelect = document.getElementById("busStopSelect");
		
			$('#busStopSelect').children('option:not(:first)').remove();
			$.each(busStopsArr[key], function(i, v){
				var option = document.createElement("option");
				option.text = v.stpnm;
				option.value = v.stpnm;
				busStopSelect.add(option);
			});
			if (key === "007E" || key === "060E"){
				$.each(busStopsArr["SMEE"], function(i, v){
					var option = document.createElement("option");
					option.text = v.stpnm;
					option.value = v.stpnm;
					busStopSelect.add(option);
				});
			}
			else if (key === "007W" || key === "060W"){
				$.each(busStopsArr["SMEW"], function(i, v){
					var option = document.createElement("option");
					option.text = v.stpnm;
					option.value = v.stpnm;
					busStopSelect.add(option);
				});
			}
		}
		mdc.ripple.MDCRipple.attachTo(document.querySelector('.mdc-button'));
		// returns green, yellow, or red hex colors depending on how large 'minutes' is
		function timeColor(minutes){
			if (parseInt(minutes) <= 8)
				return "#33CC33";
			else if (parseInt(minutes) <= 16)
				return "#ffff66";
			else
				return "#ff4d4d";
		}
		
		$("#busSubmitBtn").click(function(){
			var busDisplayUL = document.getElementById("busResults");
			var li = document.createElement("li");
    		$(li).addClass("mdc-list-item");
    		$(li).css("background-color", "#E2E2E2");
    		li.appendChild(document.createTextNode("Loading..."));
    		busDisplayUL.appendChild(li);
			setTime();
			var route = document.getElementById("busRouteSelect").value;
			var dir = document.getElementById("busDirectionSelect").value;
			var stopName = document.getElementById("busStopSelect").value;
			var clkdStp = findStop(stopName, dir);
			var cta = "http://ctabustracker.com/bustime/api/v2/getpredictions&key=7hV55iRDcTmvtMmgg2y9g5JWS=";
			var end = route + "&stpid=" + clkdStp.stpid + "&format=json";
			cta += end;
			var url = proxy + cta;
			$.ajax({
		        url: url,
		        method: 'GET',
		     }).done(function(response) {
				    response = JSON.parse(response);
				   
				    if (response["bustime-response"]["error"]){
				    	// clear any previously stored data in the list
						$(busDisplayUL).empty();
				    	var li = document.createElement("li");
			    		$(li).addClass("mdc-list-item");
			    		$(li).css("background-color", "#E2E2E2");
			    		li.appendChild(document.createTextNode(" No Bus Scheduled"));
			    		busDisplayUL.appendChild(li);
				    }
				    else{
				    
						$(busDisplayUL).empty();
				    	$.each(response["bustime-response"]["prd"], function(i, v){

				    		var predictedArrival = v.prdtm;
				    		predictedArrival = insertToString(predictedArrival, "/", 4);
				    		predictedArrival = insertToString(predictedArrival, "/", 7);
				    		// calculate the amount of time it'll take for the bus to arrive
				    		var diff = Math.abs(new Date(predictedArrival) - new Date(currentDateTime));
				    		diff = millisToMinutesAndSeconds(diff);
				    		var minutes = diff.split(":")[0];
				    		// create a list item and store the time data into it
				    		var li = document.createElement("li");
			    			$(li).addClass("mdc-list-item");
				    		if (parseInt(minutes) <= 0){
				    			$(li).css("background-color", "#33CC33");
				    			li.appendChild(document.createTextNode("APPROACHING"));
				    		}
				    		else if (parseInt(minutes) < 50){
				    			$(li).css("background-color", timeColor(minutes));
				    			li.appendChild(document.createTextNode(minutes + " minutes away"));
				    		}
				    		else{
				    			$(li).css("background-color", "#E2E2E2");
				    			li.appendChild(document.createTextNode("Error: try again"));
				    		}
				    		
				    		// display the results to the user
				    		busDisplayUL.appendChild(li);
					    });
				    }
			    }).fail(function(err) {
				   		throw err;
			       });
		});
    	//second screen
	   	// set the default location to UIC SCE
	   	var userLocation = {lat: 41.872051, lng: -87.647735};
	   	var flag = false;
	   	
	   	$("#aroundMeNav").click(function(){
	   		if ("geolocation" in navigator) {	
				// get the geolocation of the user
				navigator.geolocation.getCurrentPosition(function(position) {
				  	userLocation.lat = position.coords.latitude;
				  	userLocation.lng = position.coords.longitude;
				  	flag = true;
				  	initMap();
				});
			} 
			else
			  alert("geolocation IS NOT available");
	   	});
	   	
	   	var map;
	   	var zoomValue = 15;
	   	function initMap() {
	   		var pin = userLocation;
	   		map = new google.maps.Map(document.getElementById("map"), {
	   			zoom: zoomValue,
	   			center: pin
	   		});
	   		if (flag){
	   			var marker = new google.maps.Marker({
	   				position: userLocation,
	   				map: map,
	   				title: "Your Location"
	   			});
	   		}
	   		for (var i = 0; i < 12; i++){
    			switch (i){
    				case 0:
    					addMarkers("007E");
    					break;
    				case 1:
    					addMarkers("007W");
    					break;
    				case 2:
    					addMarkers("008S");
    					break;
    				case 3:
    					addMarkers("008N");
    					break;
    				case 4:
    					addMarkers("012E");
    					break;
    				case 5:
    					addMarkers("012W");
    					break;
    				case 6:
    					addMarkers("060E");
    					break;
    				case 7:
    					addMarkers("060W");
    					break;
    				case 8:
    					addMarkers("157E");
    					break;
    				case 9:
    					addMarkers("157W");
    					break;
    				case 10:
    					addMarkers("SMEE");
    					break;
    				case 11:
    					addMarkers("SMEW");

    			}
    		}
	   	}
	   	
	    function busContentString(v){
	    	var gMapsURL = "https://www.google.com/maps/?q=";
	    	var loc = v.lat + "," + v.lon;
	    	gMapsURL += loc;
			var contentString = 
				'<div id="content">'+
					'<h1 id="firstHeading" class="firstHeading">' + v.stpnm + '</h1>'+
					'<div id="bodyContent">'+
						'<p>' + "<strong>Route Number: </strong>" + v.rt + '</p>'+
						'<p>' + "<strong>Route Direction: </strong>" + v.dir + '</p>'+
						'<p>' + "<strong>Stop ID: </strong>" + v.stpid + '</p>'+
						'<p><a href=' + gMapsURL +'>' + 'Open in  Google Maps</a></p>'+
					'</div>'+
				'</div>';
			return contentString;
	    }
	    /
	    
	   	function addMarkers(key){
	   		if (key === "BLUE"){
	   			$.each(bluelineFP, function(i, v){
	   				var latitude = v.lat;
	   				var longitude = v.lon;
	   				var color = colors[key];
	   				var contentString = trainContentString(v);
	   				// create the marker for this stop
					var marker = new google.maps.Marker({
						position: {lat: latitude, lng: longitude},
						map: map,
						title: name,
						icon: 
						{
					        path: google.maps.SymbolPath.CIRCLE,
					        scale: 5.5,
					        fillColor: color,
					        fillOpacity: 1.0,
					        strokeWeight: 0.4
					    }
					});
					// create the info window for this stop
			        var infowindow = new google.maps.InfoWindow({
			        	content: contentString
			        });
			        // add a listener to the marker to display the info window when clicked
			        marker.addListener('click', function() {
			        	infowindow.open(map, marker);
			        });
				});
	   		}
	   		else{
	   			$.each(busStopsArr[key], function(i, v){
		   			var latitude = v.lat;
		   			var longitude = v.lon;
		   			var color = colors[key];
		   			var contentString = busContentString(v);
		   			// create the marker for this stop
					var marker = new google.maps.Marker({
						position: {lat: latitude, lng: longitude},
						map: map,
						title: name,
						icon: 
						{
					        path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
					        scale: 5.5,
					        fillColor: color,
					        fillOpacity: 1.0,
					        strokeWeight: 0.4
					    }
					});
					// create the info window for this stop
			        var infowindow = new google.maps.InfoWindow({
			        	content: contentString
			        });
			        // add a listener to the marker to display the info window when clicked
			        marker.addListener('click', function() {
			        	infowindow.open(map, marker);
			        });
				});
	   		}
	   	}
	   	
	 
		const distanceSelect = new mdc.select.MDCSelect(document.querySelector("#distanceDiv"));
		// action listener for the drop down menu on the distance screen
		$("#distanceSelect").change(function(){
			document.getElementById("saveChanges").disabled = false;
		});
		// IndexedDB
	   	var db = new Dexie('MyTransitApp-distance');
	   	db.version(1).stores({
	   		preferences: 'id,value'
	   	});
	   	db.open().catch(function(err){
	   		console.log("Error trying to open database");
	   	});
	   	db.preferences.add({id:1, value:"15"});

		$("#saveChanges").click(function(){
			var distanceSelect = document.getElementById("distanceSelect");
			var clickedValue = distanceSelect.options[distanceSelect.selectedIndex].value;
			var saveResultUL = document.getElementById("saveResults");
			var li = document.createElement("li");
    		$(li).addClass("mdc-list-item");
			db.preferences.update(1,{value:clickedValue})
				.then(function(update){
					if (update)
						li.appendChild(document.createTextNode("Added to your Favorites"));
					else
						li.appendChild(document.createTextNode("Error adding your favorites"));
				});
			saveResultUL.appendChild(li);
			zoomValue = parseInt(clickedValue);
			initMap();
		});
	   	
	   	if ('serviceWorker' in navigator){
	   		window.addEventListener('load', function(){
	   			navigator.serviceWorker.register('./sw.js').then(function(registration){
	   				console.log('ServiceWorker registration successful with scope: ', registration.scope);
	   			}, function(err){
	   				console.log('ServiceWorker registration failed: ', err);
	   			});
	   		});
	   	}
    </script>
    <!-- Google Maps API -->
    <script async defer
    	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGh-9CfWJkEQ0i-8h8q9030sx2-mb1ScI&callback=initMap">
    </script>
</body>
</html>